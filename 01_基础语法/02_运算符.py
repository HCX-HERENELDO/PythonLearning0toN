#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
模块名称：运算符
学习目标：掌握 Python 各种运算符的使用
PyCharm 技巧：学习使用调试功能查看表达式的计算过程
============================================================================
"""

# ============================================================================
# 第一部分：算术运算符
# ============================================================================
"""
【概念讲解】
算术运算符用于执行数学运算，是最基础的运算符类型。
"""

# ----------------------------------------------------------------------------
# 基本算术运算符
# ----------------------------------------------------------------------------

a, b = 10, 3

# 加法
print(f"{a} + {b} = {a + b}")      # 13

# 减法
print(f"{a} - {b} = {a - b}")      # 7

# 乘法
print(f"{a} * {b} = {a * b}")      # 30

# 除法（结果总是浮点数）
print(f"{a} / {b} = {a / b}")      # 3.333...

# 整除（向下取整）
print(f"{a} // {b} = {a // b}")    # 3

# 取余（模运算）
print(f"{a} % {b} = {a % b}")      # 1

# 幂运算
print(f"{a} ** {b} = {a ** b}")    # 1000

# 【PyCharm 技巧】
# 在调试模式下，可以逐步执行，观察每个运算的结果
# 在行号旁边点击设置断点，然后右键选择 "Debug"

# ----------------------------------------------------------------------------
# 整除的特殊情况
# ----------------------------------------------------------------------------

# 整除总是向下取整（向负无穷方向）
print("正数整除:", 7 // 3)    # 2
print("负数整除:", -7 // 3)   # -3（向下取整，不是 -2）
print("负数整除:", 7 // -3)   # -3

# 这与 C/Java 的行为不同！
# Python 的整除：floor(a / b)
# C 的整除：向零取整

# ----------------------------------------------------------------------------
# 运算符优先级
# ----------------------------------------------------------------------------

# 优先级从高到低：
# 1. ** （幂运算）
# 2. +x, -x （正负号）
# 3. *, /, //, % （乘除）
# 4. +, - （加减）

result = 2 + 3 * 4      # 14，先乘后加
print(f"2 + 3 * 4 = {result}")

result = (2 + 3) * 4    # 20，括号改变优先级
print(f"(2 + 3) * 4 = {result}")

result = 2 ** 3 ** 2    # 512，幂运算从右向左
print(f"2 ** 3 ** 2 = {result}")  # 等价于 2 ** (3 ** 2)

# 【建议】复杂的表达式使用括号明确优先级，提高可读性

# ============================================================================
# 第二部分：比较运算符
# ============================================================================
"""
【概念讲解】
比较运算符用于比较两个值，返回布尔值 True 或 False。
"""

x, y = 10, 5

# 等于
print(f"{x} == {y}: {x == y}")   # False
print(f"{x} == 10: {x == 10}")   # True

# 不等于
print(f"{x} != {y}: {x != y}")   # True

# 大于
print(f"{x} > {y}: {x > y}")     # True

# 小于
print(f"{x} < {y}: {x < y}")     # False

# 大于等于
print(f"{x} >= 10: {x >= 10}")   # True

# 小于等于
print(f"{y} <= 5: {y <= 5}")     # True

# ----------------------------------------------------------------------------
# 链式比较
# ----------------------------------------------------------------------------

# Python 支持链式比较
age = 25

# 传统写法
is_valid = age >= 18 and age <= 60

# 链式比较（更简洁）
is_valid = 18 <= age <= 60
print(f"年龄有效: {is_valid}")

# 链式比较可以任意组合
num = 5
print(f"1 < {num} < 10: {1 < num < 10}")   # True
print(f"1 < {num} < 3: {1 < num < 3}")     # False

# ----------------------------------------------------------------------------
# 比较不同类型
# ----------------------------------------------------------------------------

# 数字之间可以比较
print(f"1 == 1.0: {1 == 1.0}")   # True，值相等

# 字符串比较（按字典序）
print(f"'abc' < 'abd': {'abc' < 'abd'}")  # True
print(f"'ABC' < 'abc': {'ABC' < 'abc'}")  # True，大写字母的 ASCII 码更小

# 字符串和数字比较会报错
# print(1 < "2")  # TypeError

# None 的比较
print(f"None == None: {None == None}")  # True
print(f"None is None: {None is None}")  # True（推荐用 is）

# ============================================================================
# 第三部分：逻辑运算符
# ============================================================================
"""
【概念讲解】
逻辑运算符用于组合布尔值，返回布尔结果。
"""

# ----------------------------------------------------------------------------
# 基本逻辑运算
# ----------------------------------------------------------------------------

p, q = True, False

# 与运算（and）：两者都为 True 才为 True
print(f"{p} and {q}: {p and q}")  # False
print(f"{p} and True: {p and True}")  # True

# 或运算（or）：有一个为 True 就为 True
print(f"{p} or {q}: {p or q}")    # True
print(f"False or {q}: {False or q}")  # False

# 非运算（not）：取反
print(f"not {p}: {not p}")        # False
print(f"not {q}: {not q}")        # True

# ----------------------------------------------------------------------------
# 短路求值
# ----------------------------------------------------------------------------

"""
【重要概念】短路求值（Short-circuit evaluation）

and 运算：
- 如果第一个值为 False，直接返回第一个值，不计算第二个
- 如果第一个值为 True，返回第二个值

or 运算：
- 如果第一个值为 True，直接返回第一个值，不计算第二个
- 如果第一个值为 False，返回第二个值
"""

# and 的短路
def func1():
    print("func1 被调用")
    return True

result = False and func1()  # func1 不会被调用
print(f"短路结果: {result}")

# or 的短路
result = True or func1()    # func1 不会被调用
print(f"短路结果: {result}")

# 利用短路设置默认值
name = ""  # 空字符串为假值
default_name = name or "匿名用户"
print(f"默认名称: {default_name}")

# 利用短路避免错误
# value = None
# result = value and value.some_method()  # 如果 value 为 None，不会调用方法

# ----------------------------------------------------------------------------
# 逻辑运算符返回值
# ----------------------------------------------------------------------------

# 逻辑运算符返回的是决定结果的那个值，不一定是布尔值
print("1 and 2:", 1 and 2)      # 2（1 为真，返回第二个值）
print("0 and 2:", 0 and 2)      # 0（0 为假，短路返回第一个值）
print("1 or 2:", 1 or 2)        # 1（1 为真，短路返回第一个值）
print("0 or 2:", 0 or 2)        # 2（0 为假，返回第二个值）

# ============================================================================
# 第四部分：赋值运算符
# ============================================================================

# ----------------------------------------------------------------------------
# 基本赋值
# ----------------------------------------------------------------------------

x = 10       # 基本赋值
print(f"x = {x}")

# 多重赋值
a = b = c = 0
print(f"多重赋值: a={a}, b={b}, c={c}")

# 解包赋值
x, y, z = 1, 2, 3
print(f"解包赋值: x={x}, y={y}, z={z}")

# 交换变量值（Python 特色）
x, y = y, x
print(f"交换后: x={x}, y={y}")

# ----------------------------------------------------------------------------
# 复合赋值运算符
# ----------------------------------------------------------------------------

num = 10

num += 5    # 等价于 num = num + 5
print(f"+= 5: {num}")   # 15

num -= 3    # 等价于 num = num - 3
print(f"-= 3: {num}")   # 12

num *= 2    # 等价于 num = num * 2
print(f"*= 2: {num}")   # 24

num //= 5   # 等价于 num = num // 5
print(f"//= 5: {num}")  # 4

num **= 3   # 等价于 num = num ** 3
print(f"**= 3: {num}")  # 64

# 字符串也支持复合赋值
greeting = "Hello"
greeting += ", World!"
print(greeting)

# ============================================================================
# 第五部分：位运算符
# ============================================================================
"""
【概念讲解】
位运算符对整数的二进制位进行操作。
在底层开发、算法优化中常用。
"""

# ----------------------------------------------------------------------------
# 基本位运算
# ----------------------------------------------------------------------------

a, b = 60, 13  # 二进制: 60=00111100, 13=00001101

# 按位与（&）：两位都为1才为1
print(f"{a} & {b} = {a & b}")    # 12 (00001100)

# 按位或（|）：有一位为1就为1
print(f"{a} | {b} = {a | b}")    # 61 (00111101)

# 按位异或（^）：两位不同为1
print(f"{a} ^ {b} = {a ^ b}")    # 49 (00110001)

# 按位取反（~）：0变1，1变0
print(f"~{a} = {~a}")           # -61（注意：~x = -(x+1)）

# 左移（<<）：所有位左移，低位补0
print(f"{a} << 2 = {a << 2}")   # 240 (11110000)

# 右移（>>）：所有位右移，高位补符号位
print(f"{a} >> 2 = {a >> 2}")   # 15 (00001111)

# ----------------------------------------------------------------------------
# 位运算技巧
# ----------------------------------------------------------------------------

# 判断奇偶
num = 7
is_odd = num & 1  # 结果为1是奇数，为0是偶数
print(f"{num} 是奇数: {bool(is_odd)}")

# 交换两个数（不使用临时变量）
x, y = 5, 3
x = x ^ y
y = x ^ y
x = x ^ y
print(f"交换结果: x={x}, y={y}")

# 快速乘除2的幂
n = 10
print(f"{n} * 2 = {n << 1}")    # 左移1位等于乘2
print(f"{n} * 4 = {n << 2}")    # 左移2位等于乘4
print(f"{n} // 2 = {n >> 1}")   # 右移1位等于除2

# ============================================================================
# 第六部分：成员运算符
# ============================================================================

# ----------------------------------------------------------------------------
# in 和 not in
# ----------------------------------------------------------------------------

# 检查元素是否在序列中
fruits = ["苹果", "香蕉", "橙子"]

print(f"'苹果' in fruits: {'苹果' in fruits}")    # True
print(f"'葡萄' in fruits: {'葡萄' in fruits}")    # False
print(f"'葡萄' not in fruits: {'葡萄' not in fruits}")  # True

# 字符串中的使用
text = "Hello, Python!"
print(f"'Python' in text: {'Python' in text}")    # True
print(f"'Java' in text: {'Java' in text}")        # False

# 字典中的使用（检查键）
scores = {"语文": 90, "数学": 85}
print(f"'语文' in scores: {'语文' in scores}")    # True
print(f"90 in scores: {90 in scores}")            # False（只检查键）

# ============================================================================
# 第七部分：身份运算符
# ============================================================================

# ----------------------------------------------------------------------------
# is 和 is not
# ----------------------------------------------------------------------------

"""
【重要区别】
== 比较的是值是否相等
is 比较的是是否是同一个对象（内存地址是否相同）
"""

a = [1, 2, 3]
b = [1, 2, 3]
c = a

print(f"a == b: {a == b}")    # True，值相等
print(f"a is b: {a is b}")    # False，不同对象
print(f"a is c: {a is c}")    # True，同一对象

# 小整数缓存（-5 到 256）
x = 256
y = 256
print(f"小整数缓存: {x is y}")  # True

x = 257
y = 257
print(f"大整数: {x is y}")      # 可能是 False（取决于实现）

# 字符串缓存
s1 = "hello"
s2 = "hello"
print(f"字符串缓存: {s1 is s2}")  # True

# 动态创建的字符串不缓存
s3 = "hel" + "lo"
s4 = "".join(["hel", "lo"])
print(f"动态字符串: {s3 is s4}")  # 可能是 False

# None 的比较应该用 is
value = None
if value is None:  # 推荐
    print("value 是 None")

# ============================================================================
# 第八部分：海象运算符（Python 3.8+）
# ============================================================================

# ----------------------------------------------------------------------------
# := 运算符
# ----------------------------------------------------------------------------

"""
【概念讲解】
海象运算符（:=）允许在表达式中进行赋值。
可以简化代码，避免重复计算。
"""

# 传统写法
text = "Hello, World!"
length = len(text)
if length > 10:
    print(f"文本长度 {length} 超过10")

# 使用海象运算符
if (n := len(text)) > 10:
    print(f"文本长度 {n} 超过10")

# 在 while 循环中使用
# while (line := input("输入（空退出）: ")) != "":
#     print(f"你输入了: {line}")

# 在列表推导式中使用
data = [1, 2, 3, 4, 5]
# 计算平方并过滤大于10的
filtered = [square for x in data if (square := x ** 2) > 10]
print(f"过滤结果: {filtered}")

# ============================================================================
# 运算符优先级总结
# ============================================================================
"""
优先级从高到低：

1. **                       幂运算
2. +x, -x, ~x               正负号、按位取反
3. *, /, //, %              乘除、整除、取余
4. +, -                     加减
5. <<, >>                   移位
6. &                        按位与
7. ^                        按位异或
8. |                        按位或
9. ==, !=, <, <=, >, >=     比较运算
10. is, is not              身份运算
11. in, not in              成员运算
12. not                     逻辑非
13. and                     逻辑与
14. or                      逻辑或
15. :=                      海象运算符

【建议】使用括号明确优先级，不要依赖记忆！
"""

# ============================================================================
# 练习题
# ============================================================================
"""
【练习1】计算下列表达式的结果：
1. 17 // 5 = ?
2. 17 % 5 = ?
3. 2 ** 3 ** 2 = ?
4. 10 > 5 and 3 < 1 = ?
5. not (True and False) = ?

【练习2】使用位运算：
1. 判断一个数是否是2的幂
2. 不用+号实现两个数相加
3. 找出唯一不成对的数（其他数都出现两次）

【练习3】简化代码：
将以下代码使用海象运算符简化：
    user_input = input("请输入: ")
    while user_input != "quit":
        print(user_input)
        user_input = input("请输入: ")
"""

# ============================================================================
# 本节小结
# ============================================================================
"""
✅ 掌握的知识点：
1. 算术运算符：+, -, *, /, //, %, **
2. 比较运算符：==, !=, <, >, <=, >=
3. 逻辑运算符：and, or, not
4. 赋值运算符：=, +=, -=, *=, /=
5. 位运算符：&, |, ^, ~, <<, >>
6. 成员运算符：in, not in
7. 身份运算符：is, is not
8. 海象运算符：:=

🔧 PyCharm 技巧：
1. 断点调试查看表达式计算过程
2. Evaluate Expression 执行任意表达式
3. Variables 面板实时查看变量变化

➡️ 下一节：字符串操作
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("运算符模块学习完成！")
    print("=" * 60)
