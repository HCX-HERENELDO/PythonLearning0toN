#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
æ¨¡å—åç§°ï¼šå­—å…¸
å­¦ä¹ ç›®æ ‡ï¼šæ·±å…¥æŒæ¡å­—å…¸çš„åˆ›å»ºã€æ“ä½œå’Œåº”ç”¨åœºæ™¯
PyCharm æŠ€å·§ï¼šå­¦ä¹ æŸ¥çœ‹å­—å…¸çš„å†…éƒ¨ç»“æ„
============================================================================
"""

# ============================================================================
# ç¬¬ä¸€éƒ¨åˆ†ï¼šå­—å…¸åŸºç¡€
# ============================================================================
"""
ã€æ¦‚å¿µè®²è§£ã€‘
å­—å…¸ï¼ˆDictionaryï¼‰æ˜¯ Python ä¸­çš„æ˜ å°„ç±»å‹ï¼Œå­˜å‚¨é”®å€¼å¯¹ï¼ˆkey-value pairsï¼‰ã€‚
é”®å¿…é¡»æ˜¯ä¸å¯å˜ç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å…ƒç»„ï¼‰ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚
å­—å…¸æ˜¯æ— åºçš„ï¼ˆPython 3.7+ ä¿æŒæ’å…¥é¡ºåºï¼‰ã€‚
"""

# ----------------------------------------------------------------------------
# åˆ›å»ºå­—å…¸
# ----------------------------------------------------------------------------

# ç›´æ¥åˆ›å»º
student = {
    "name": "å¼ ä¸‰",
    "age": 20,
    "grade": "å¤§ä¸‰"
}

# ç©ºå­—å…¸
empty1 = {}
empty2 = dict()

# ä½¿ç”¨ dict() å‡½æ•°
student2 = dict(name="æå››", age=18, grade="å¤§ä¸€")
scores = dict([("è¯­æ–‡", 90), ("æ•°å­¦", 85), ("è‹±è¯­", 92)])

# ä½¿ç”¨ fromkeys() åˆ›å»º
keys = ["a", "b", "c"]
default_dict = dict.fromkeys(keys, 0)  # æ‰€æœ‰å€¼åˆå§‹åŒ–ä¸º 0
print(f"é»˜è®¤å­—å…¸: {default_dict}")

# å­—å…¸æ¨å¯¼å¼
squares = {x: x ** 2 for x in range(5)}
print(f"å¹³æ–¹å­—å…¸: {squares}")

# ã€PyCharm æŠ€å·§ã€‘
# åœ¨ Variables é¢æ¿å¯ä»¥å±•å¼€å­—å…¸æŸ¥çœ‹é”®å€¼å¯¹

# ----------------------------------------------------------------------------
# è®¿é—®å­—å…¸
# ----------------------------------------------------------------------------

student = {"name": "å¼ ä¸‰", "age": 20, "grade": "å¤§ä¸‰"}

# é€šè¿‡é”®è®¿é—®
print(f"å§“å: {student['name']}")

# ä½¿ç”¨ get() æ–¹æ³•ï¼ˆæ¨èï¼‰
print(f"å¹´é¾„: {student.get('age')}")

# get() è®¾ç½®é»˜è®¤å€¼
print(f"æ€§åˆ«: {student.get('gender', 'æœªçŸ¥')}")

# é¿å…é”®ä¸å­˜åœ¨çš„é”™è¯¯
# print(student['gender'])  # KeyError
print(student.get('gender'))  # è¿”å› Noneï¼Œä¸æŠ¥é”™

# ============================================================================
# ç¬¬äºŒéƒ¨åˆ†ï¼šå­—å…¸çš„ä¿®æ”¹
# ============================================================================

# ----------------------------------------------------------------------------
# æ·»åŠ å’Œä¿®æ”¹
# ----------------------------------------------------------------------------

student = {"name": "å¼ ä¸‰", "age": 20}

# æ·»åŠ æ–°é”®å€¼å¯¹
student["gender"] = "ç”·"
print(f"æ·»åŠ å: {student}")

# ä¿®æ”¹å·²æœ‰é”®
student["age"] = 21
print(f"ä¿®æ”¹å: {student}")

# setdefault() - å¦‚æœé”®ä¸å­˜åœ¨åˆ™æ·»åŠ 
student.setdefault("grade", "å¤§ä¸‰")
print(f"setdefault: {student}")

# å·²å­˜åœ¨çš„é”®ä¸ä¼šä¿®æ”¹
student.setdefault("age", 18)  # age ä¿æŒ 21
print(f"setdefault å·²å­˜åœ¨: {student}")

# ----------------------------------------------------------------------------
# åˆ é™¤å…ƒç´ 
# ----------------------------------------------------------------------------

scores = {"è¯­æ–‡": 90, "æ•°å­¦": 85, "è‹±è¯­": 92, "ç‰©ç†": 88}

# del è¯­å¥
del scores["ç‰©ç†"]
print(f"del å: {scores}")

# pop() - åˆ é™¤å¹¶è¿”å›å€¼
math_score = scores.pop("æ•°å­¦")
print(f"pop åˆ é™¤: {math_score}")
print(f"pop å: {scores}")

# pop() è®¾ç½®é»˜è®¤å€¼ï¼ˆé”®ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™ï¼‰
value = scores.pop("åŒ–å­¦", "ä¸å­˜åœ¨")
print(f"pop é»˜è®¤å€¼: {value}")

# popitem() - åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªé”®å€¼å¯¹
last = scores.popitem()
print(f"popitem: {last}")

# clear() - æ¸…ç©ºå­—å…¸
student = {"name": "å¼ ä¸‰"}
student.clear()
print(f"clear å: {student}")

# ----------------------------------------------------------------------------
# åˆå¹¶å­—å…¸
# ----------------------------------------------------------------------------

dict1 = {"a": 1, "b": 2}
dict2 = {"c": 3, "d": 4}

# update() æ–¹æ³•
dict1.update(dict2)
print(f"update: {dict1}")

# è§£åŒ…åˆå¹¶ï¼ˆPython 3.5+ï¼‰
merged = {**dict1, **dict2}
print(f"è§£åŒ…åˆå¹¶: {merged}")

# | è¿ç®—ç¬¦ï¼ˆPython 3.9+ï¼‰
# merged = dict1 | dict2

# ============================================================================
# ç¬¬ä¸‰éƒ¨åˆ†ï¼šå­—å…¸çš„éå†
# ============================================================================

student = {"name": "å¼ ä¸‰", "age": 20, "grade": "å¤§ä¸‰"}

# ----------------------------------------------------------------------------
# éå†é”®
# ----------------------------------------------------------------------------

# æ–¹æ³•1ï¼šç›´æ¥éå†
print("éå†é”®:")
for key in student:
    print(f"  {key}")

# æ–¹æ³•2ï¼škeys() æ–¹æ³•
for key in student.keys():
    print(f"  é”®: {key}")

# ----------------------------------------------------------------------------
# éå†å€¼
# ----------------------------------------------------------------------------

print("éå†å€¼:")
for value in student.values():
    print(f"  å€¼: {value}")

# ----------------------------------------------------------------------------
# éå†é”®å€¼å¯¹
# ----------------------------------------------------------------------------

print("éå†é”®å€¼å¯¹:")
for key, value in student.items():
    print(f"  {key}: {value}")

# å¸¦ç´¢å¼•éå†
print("å¸¦ç´¢å¼•éå†:")
for index, (key, value) in enumerate(student.items()):
    print(f"  {index}. {key}: {value}")

# ============================================================================
# ç¬¬å››éƒ¨åˆ†ï¼šå­—å…¸å¸¸ç”¨æ–¹æ³•
# ============================================================================

# ----------------------------------------------------------------------------
# æŸ¥æ‰¾æ–¹æ³•
# ----------------------------------------------------------------------------

student = {"name": "å¼ ä¸‰", "age": 20}

# æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
print(f"'name' in student: {'name' in student}")
print(f"'gender' in student: {'gender' in student}")

# è·å–æ‰€æœ‰é”®/å€¼
print(f"æ‰€æœ‰é”®: {list(student.keys())}")
print(f"æ‰€æœ‰å€¼: {list(student.values())}")
print(f"æ‰€æœ‰é”®å€¼å¯¹: {list(student.items())}")

# ----------------------------------------------------------------------------
# å­—å…¸é•¿åº¦
# ----------------------------------------------------------------------------

print(f"å­—å…¸é•¿åº¦: {len(student)}")

# ============================================================================
# ç¬¬äº”éƒ¨åˆ†ï¼šå­—å…¸çš„é«˜çº§ç”¨æ³•
# ============================================================================

# ----------------------------------------------------------------------------
# åµŒå¥—å­—å…¸
# ----------------------------------------------------------------------------

# å¤šå±‚åµŒå¥—
school = {
    "class1": {
        "students": [
            {"name": "å¼ ä¸‰", "age": 20},
            {"name": "æå››", "age": 19},
        ],
        "teacher": "ç‹è€å¸ˆ"
    },
    "class2": {
        "students": [
            {"name": "ç‹äº”", "age": 21},
        ],
        "teacher": "æè€å¸ˆ"
    }
}

# è®¿é—®åµŒå¥—æ•°æ®
print(f"ç­çº§1çš„å­¦ç”Ÿ: {school['class1']['students']}")
print(f"ç¬¬ä¸€ä¸ªå­¦ç”Ÿ: {school['class1']['students'][0]['name']}")

# ----------------------------------------------------------------------------
# å­—å…¸æ’åº
# ----------------------------------------------------------------------------

scores = {"è¯­æ–‡": 90, "æ•°å­¦": 85, "è‹±è¯­": 92}

# æŒ‰é”®æ’åº
sorted_by_key = dict(sorted(scores.items()))
print(f"æŒ‰é”®æ’åº: {sorted_by_key}")

# æŒ‰å€¼æ’åº
sorted_by_value = dict(sorted(scores.items(), key=lambda x: x[1], reverse=True))
print(f"æŒ‰å€¼é™åº: {sorted_by_value}")

# ----------------------------------------------------------------------------
# å­—å…¸åè½¬ï¼ˆé”®å€¼äº’æ¢ï¼‰
# ----------------------------------------------------------------------------

original = {"a": 1, "b": 2, "c": 3}
reversed_dict = {v: k for k, v in original.items()}
print(f"åè½¬å­—å…¸: {reversed_dict}")

# æ³¨æ„ï¼šå¦‚æœæœ‰é‡å¤å€¼ï¼Œä¼šä¸¢å¤±æ•°æ®
duplicate = {"a": 1, "b": 1, "c": 2}
reversed_dup = {v: k for k, v in duplicate.items()}
print(f"é‡å¤å€¼åè½¬: {reversed_dup}")  # åªä¿ç•™æœ€åä¸€ä¸ª

# ============================================================================
# ç¬¬å…­éƒ¨åˆ†ï¼šdefaultdict å’Œ Counter
# ============================================================================

from collections import defaultdict, Counter

# ----------------------------------------------------------------------------
# defaultdict
# ----------------------------------------------------------------------------

# æ™®é€š dict çš„é—®é¢˜
word_count = {}
words = ["apple", "banana", "apple", "orange", "banana", "apple"]

for word in words:
    if word in word_count:
        word_count[word] += 1
    else:
        word_count[word] = 1

# ä½¿ç”¨ defaultdict ç®€åŒ–
word_count = defaultdict(int)  # é»˜è®¤å€¼ä¸º 0
for word in words:
    word_count[word] += 1

print(f"è¯é¢‘ç»Ÿè®¡: {dict(word_count)}")

# å…¶ä»–é»˜è®¤å€¼ç±»å‹
list_dict = defaultdict(list)  # é»˜è®¤å€¼ä¸ºç©ºåˆ—è¡¨
list_dict["fruits"].append("apple")
print(f"åˆ—è¡¨å­—å…¸: {dict(list_dict)}")

# ----------------------------------------------------------------------------
# Counter
# ----------------------------------------------------------------------------

# è®¡æ•°å™¨
words = ["apple", "banana", "apple", "orange", "banana", "apple"]
counter = Counter(words)

print(f"è®¡æ•°å™¨: {counter}")
print(f"apple æ•°é‡: {counter['apple']}")
print(f"æœ€å¸¸è§çš„ä¸¤ä¸ª: {counter.most_common(2)}")

# Counter è¿ç®—
c1 = Counter("aabbcc")
c2 = Counter("aabdd")

print(f"ç›¸åŠ : {c1 + c2}")
print(f"ç›¸å‡: {c1 - c2}")
print(f"äº¤é›†: {c1 & c2}")
print(f"å¹¶é›†: {c1 | c2}")

# ============================================================================
# ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå­—å…¸çš„å®é™…åº”ç”¨
# ============================================================================

# ----------------------------------------------------------------------------
# ç¼“å­˜/è®°å¿†åŒ–
# ----------------------------------------------------------------------------

# æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆå¸¦ç¼“å­˜ï¼‰
fib_cache = {}

def fib(n):
    if n in fib_cache:
        return fib_cache[n]
    
    if n <= 1:
        result = n
    else:
        result = fib(n - 1) + fib(n - 2)
    
    fib_cache[n] = result
    return result

print(f"fib(20) = {fib(20)}")

# ä½¿ç”¨ functools.lru_cache è£…é¥°å™¨
from functools import lru_cache

@lru_cache(maxsize=128)
def fib_cached(n):
    if n <= 1:
        return n
    return fib_cached(n - 1) + fib_cached(n - 2)

print(f"fib_cached(30) = {fib_cached(30)}")

# ----------------------------------------------------------------------------
# åˆ†ç»„
# ----------------------------------------------------------------------------

students = [
    {"name": "å¼ ä¸‰", "class": "A"},
    {"name": "æå››", "class": "B"},
    {"name": "ç‹äº”", "class": "A"},
    {"name": "èµµå…­", "class": "B"},
]

# æŒ‰ç­çº§åˆ†ç»„
from collections import defaultdict
grouped = defaultdict(list)
for student in students:
    grouped[student["class"]].append(student["name"])

print(f"åˆ†ç»„ç»“æœ: {dict(grouped)}")

# ----------------------------------------------------------------------------
# é…ç½®ç®¡ç†
# ----------------------------------------------------------------------------

# é»˜è®¤é…ç½®
DEFAULT_CONFIG = {
    "host": "localhost",
    "port": 8080,
    "debug": False,
    "max_connections": 100,
}

# ç”¨æˆ·é…ç½®
user_config = {
    "port": 3000,
    "debug": True,
}

# åˆå¹¶é…ç½®ï¼ˆç”¨æˆ·é…ç½®è¦†ç›–é»˜è®¤é…ç½®ï¼‰
config = {**DEFAULT_CONFIG, **user_config}
print(f"æœ€ç»ˆé…ç½®: {config}")

# ============================================================================
# ç»ƒä¹ é¢˜
# ============================================================================
"""
ã€ç»ƒä¹ 1ã€‘å­—å…¸æ“ä½œ
åˆ›å»ºä¸€ä¸ªé€šè®¯å½•å­—å…¸ï¼Œå®ç°ï¼š
1. æ·»åŠ è”ç³»äºº
2. åˆ é™¤è”ç³»äºº
3. æŸ¥æ‰¾è”ç³»äºº
4. ä¿®æ”¹è”ç³»äººä¿¡æ¯

ã€ç»ƒä¹ 2ã€‘å­—å…¸ç»Ÿè®¡
ç»™å®šå­—ç¬¦ä¸²ï¼Œç»Ÿè®¡æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼š
"hello world, welcome to python!"

ã€ç»ƒä¹ 3ã€‘å­—å…¸è½¬æ¢
å°†ä¸¤ä¸ªåˆ—è¡¨åˆå¹¶ä¸ºå­—å…¸ï¼š
keys = ['name', 'age', 'city']
values = ['å¼ ä¸‰', 20, 'åŒ—äº¬']
"""

# ============================================================================
# æœ¬èŠ‚å°ç»“
# ============================================================================
"""
âœ… æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼š
1. å­—å…¸çš„åˆ›å»ºå’Œè®¿é—®
2. å­—å…¸çš„æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤
3. å­—å…¸çš„éå†æ–¹å¼
4. å­—å…¸æ¨å¯¼å¼
5. åµŒå¥—å­—å…¸
6. defaultdict å’Œ Counter
7. å­—å…¸çš„å®é™…åº”ç”¨åœºæ™¯

ğŸ”§ PyCharm æŠ€å·§ï¼š
1. Variables é¢æ¿å±•å¼€å­—å…¸
2. ä½¿ç”¨ Evaluate Expression æµ‹è¯•å­—å…¸æ“ä½œ
3. Quick Documentation æŸ¥çœ‹æ–¹æ³•è¯´æ˜

â¡ï¸ ä¸‹ä¸€èŠ‚ï¼šé›†åˆ
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("å­—å…¸æ¨¡å—å­¦ä¹ å®Œæˆï¼")
    print("=" * 60)
