#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
æ¨¡å—åç§°ï¼šé€’å½’å‡½æ•°
å­¦ä¹ ç›®æ ‡ï¼šç†è§£é€’å½’æ€æƒ³ï¼ŒæŒæ¡é€’å½’å‡½æ•°çš„ç¼–å†™
PyCharm æŠ€å·§ï¼šå­¦ä¹ è°ƒè¯•é€’å½’å‡½æ•°ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆ
============================================================================
"""

# ============================================================================
# ç¬¬ä¸€éƒ¨åˆ†ï¼šé€’å½’åŸºç¡€
# ============================================================================
"""
ã€æ¦‚å¿µè®²è§£ã€‘
é€’å½’æ˜¯å‡½æ•°è°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€æœ¯ã€‚
é€’å½’éœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š
1. åŸºå‡†æ¡ä»¶ï¼ˆBase Caseï¼‰ï¼šç»ˆæ­¢é€’å½’çš„æ¡ä»¶
2. é€’å½’æ¡ä»¶ï¼ˆRecursive Caseï¼‰ï¼šå‘åŸºå‡†æ¡ä»¶é è¿‘
"""

# ----------------------------------------------------------------------------
# ç»å…¸é€’å½’ï¼šé˜¶ä¹˜
# ----------------------------------------------------------------------------

def factorial(n):
    """
    è®¡ç®—é˜¶ä¹˜ n!
    
    é€’å½’æ€è·¯ï¼š
    - åŸºå‡†æ¡ä»¶ï¼š0! = 1
    - é€’å½’æ¡ä»¶ï¼šn! = n * (n-1)!
    """
    # åŸºå‡†æ¡ä»¶
    if n == 0:
        return 1
    # é€’å½’æ¡ä»¶
    return n * factorial(n - 1)

print(f"5! = {factorial(5)}")  # 120
print(f"10! = {factorial(10)}")

# ã€PyCharm æŠ€å·§ã€‘
# åœ¨é€’å½’å‡½æ•°è®¾ç½®æ–­ç‚¹ï¼Œè§‚å¯Ÿè°ƒç”¨æ ˆçš„å˜åŒ–
# åœ¨ Debug é¢æ¿çš„ Frames ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰é€’å½’è°ƒç”¨

# ----------------------------------------------------------------------------
# ç»å…¸é€’å½’ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—
# ----------------------------------------------------------------------------

def fibonacci(n):
    """
    è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬ n é¡¹
    
    F(0) = 0
    F(1) = 1
    F(n) = F(n-1) + F(n-2)
    """
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

print(f"æ–æ³¢é‚£å¥‘å‰10é¡¹: {[fibonacci(i) for i in range(10)]}")

# ã€é—®é¢˜ã€‘è¿™ä¸ªå®ç°æ•ˆç‡å¾ˆä½ï¼Œæœ‰å¤§é‡é‡å¤è®¡ç®—

# ============================================================================
# ç¬¬äºŒéƒ¨åˆ†ï¼šé€’å½’ä¼˜åŒ–
# ============================================================================

# ----------------------------------------------------------------------------
# è®°å¿†åŒ–ä¼˜åŒ–
# ----------------------------------------------------------------------------

from functools import lru_cache

@lru_cache(maxsize=None)
def fibonacci_cached(n):
    """å¸¦ç¼“å­˜çš„æ–æ³¢é‚£å¥‘"""
    if n <= 1:
        return n
    return fibonacci_cached(n - 1) + fibonacci_cached(n - 2)

import time

# å¯¹æ¯”æ€§èƒ½
n = 35

start = time.time()
result1 = fibonacci(n)
time1 = time.time() - start

start = time.time()
result2 = fibonacci_cached(n)
time2 = time.time() - start

print(f"æ— ç¼“å­˜: {time1:.4f}ç§’")
print(f"æœ‰ç¼“å­˜: {time2:.4f}ç§’")

# ----------------------------------------------------------------------------
# å°¾é€’å½’ä¼˜åŒ–
# ----------------------------------------------------------------------------

def factorial_tail(n, acc=1):
    """
    å°¾é€’å½’ç‰ˆæœ¬çš„é˜¶ä¹˜
    
    å°¾é€’å½’ï¼šé€’å½’è°ƒç”¨æ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥
    Python ä¸ä¼˜åŒ–å°¾é€’å½’ï¼Œä½†å†™æ³•æ›´æ¸…æ™°
    """
    if n == 0:
        return acc
    return factorial_tail(n - 1, n * acc)

print(f"å°¾é€’å½’é˜¶ä¹˜: {factorial_tail(5)}")

# ============================================================================
# ç¬¬ä¸‰éƒ¨åˆ†ï¼šé€’å½’åº”ç”¨
# ============================================================================

# ----------------------------------------------------------------------------
# äºŒåˆ†æŸ¥æ‰¾
# ----------------------------------------------------------------------------

def binary_search(arr, target, left=0, right=None):
    """
    é€’å½’äºŒåˆ†æŸ¥æ‰¾
    
    å‚æ•°:
        arr: å·²æ’åºçš„åˆ—è¡¨
        target: ç›®æ ‡å€¼
        left: å·¦è¾¹ç•Œ
        right: å³è¾¹ç•Œ
    
    è¿”å›:
        ç›®æ ‡ç´¢å¼•ï¼Œæœªæ‰¾åˆ°è¿”å› -1
    """
    if right is None:
        right = len(arr) - 1
    
    if left > right:
        return -1
    
    mid = (left + right) // 2
    
    if arr[mid] == target:
        return mid
    elif arr[mid] > target:
        return binary_search(arr, target, left, mid - 1)
    else:
        return binary_search(arr, target, mid + 1, right)

numbers = [1, 3, 5, 7, 9, 11, 13, 15]
print(f"æŸ¥æ‰¾ 7: ç´¢å¼• {binary_search(numbers, 7)}")
print(f"æŸ¥æ‰¾ 8: ç´¢å¼• {binary_search(numbers, 8)}")

# ----------------------------------------------------------------------------
# æ±‰è¯ºå¡”
# ----------------------------------------------------------------------------

def hanoi(n, source, target, auxiliary):
    """
    æ±‰è¯ºå¡”é—®é¢˜
    
    å‚æ•°:
        n: ç›˜å­æ•°é‡
        source: æºæŸ±å­
        target: ç›®æ ‡æŸ±å­
        auxiliary: è¾…åŠ©æŸ±å­
    """
    if n == 1:
        print(f"ç§»åŠ¨ç›˜å­ 1 ä» {source} åˆ° {target}")
        return
    
    hanoi(n - 1, source, auxiliary, target)
    print(f"ç§»åŠ¨ç›˜å­ {n} ä» {source} åˆ° {target}")
    hanoi(n - 1, auxiliary, target, source)

print("\næ±‰è¯ºå¡” (3ä¸ªç›˜å­):")
hanoi(3, 'A', 'C', 'B')

# ----------------------------------------------------------------------------
# ç›®å½•éå†
# ----------------------------------------------------------------------------

import os

def list_files(directory, indent=0):
    """é€’å½’åˆ—å‡ºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"""
    prefix = "  " * indent
    
    try:
        for item in os.listdir(directory):
            path = os.path.join(directory, item)
            if os.path.isdir(path):
                print(f"{prefix}ğŸ“ {item}/")
                list_files(path, indent + 1)
            else:
                print(f"{prefix}ğŸ“„ {item}")
    except PermissionError:
        print(f"{prefix}â›” æ— æƒé™è®¿é—®")

# å–æ¶ˆæ³¨é‡Šæµ‹è¯•
# list_files(".")

# ============================================================================
# ç¬¬å››éƒ¨åˆ†ï¼šé€’å½’ vs è¿­ä»£
# ============================================================================

# é€’å½’ç‰ˆæœ¬
def sum_recursive(n):
    """é€’å½’æ±‚å’Œ 1+2+...+n"""
    if n == 1:
        return 1
    return n + sum_recursive(n - 1)

# è¿­ä»£ç‰ˆæœ¬
def sum_iterative(n):
    """è¿­ä»£æ±‚å’Œ 1+2+...+n"""
    total = 0
    for i in range(1, n + 1):
        total += i
    return total

# å…¬å¼ç‰ˆæœ¬ï¼ˆæœ€ä¼˜ï¼‰
def sum_formula(n):
    """å…¬å¼æ±‚å’Œ"""
    return n * (n + 1) // 2

print(f"\næ±‚å’Œå¯¹æ¯”: {sum_recursive(100)}, {sum_iterative(100)}, {sum_formula(100)}")

"""
ã€é€‰æ‹©å»ºè®®ã€‘
- é€’å½’ï¼šé—®é¢˜è‡ªç„¶é€’å½’å®šä¹‰ï¼Œä»£ç æ›´æ¸…æ™°
- è¿­ä»£ï¼šæ€§èƒ½è¦æ±‚é«˜ï¼Œé¿å…æ ˆæº¢å‡º
- å…¬å¼ï¼šæ•°å­¦æ–¹æ³•ï¼Œæ•ˆç‡æœ€é«˜
"""

# ============================================================================
# ç¬¬äº”éƒ¨åˆ†ï¼šé€’å½’æ·±åº¦é™åˆ¶
# ============================================================================

import sys

print(f"\né»˜è®¤é€’å½’æ·±åº¦é™åˆ¶: {sys.getrecursionlimit()}")

# å¯ä»¥ä¿®æ”¹é™åˆ¶ï¼ˆä½†è¦æ³¨æ„å†…å­˜ï¼‰
# sys.setrecursionlimit(2000)

# è¶…è¿‡é™åˆ¶ä¼šæŠ¥ RecursionError
# def infinite_recursion():
#     return infinite_recursion()

# ============================================================================
# æœ¬èŠ‚å°ç»“
# ============================================================================
"""
âœ… æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼š
1. é€’å½’çš„åŸºæœ¬æ¦‚å¿µ
2. åŸºå‡†æ¡ä»¶å’Œé€’å½’æ¡ä»¶
3. è®°å¿†åŒ–ä¼˜åŒ–
4. å°¾é€’å½’
5. é€’å½’åº”ç”¨ï¼ˆäºŒåˆ†æŸ¥æ‰¾ã€æ±‰è¯ºå¡”ã€ç›®å½•éå†ï¼‰
6. é€’å½’ vs è¿­ä»£çš„é€‰æ‹©

ğŸ”§ PyCharm æŠ€å·§ï¼š
1. æ–­ç‚¹è°ƒè¯•é€’å½’å‡½æ•°
2. åœ¨ Frames é¢æ¿æŸ¥çœ‹è°ƒç”¨æ ˆ
3. è§‚å¯Ÿ Variables å˜åŒ–

â¡ï¸ ä¸‹ä¸€èŠ‚ï¼šåŒ¿åå‡½æ•°
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("é€’å½’å‡½æ•°æ¨¡å—å­¦ä¹ å®Œæˆï¼")
    print("=" * 60)
