#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
模块名称：函数基础
学习目标：掌握函数的定义、调用和基本用法
PyCharm 技巧：学习使用 "Go to Definition" 跳转到函数定义
============================================================================
"""

# ============================================================================
# 第一部分：函数定义与调用
# ============================================================================
"""
【概念讲解】
函数是一段可重复使用的代码块，用于完成特定任务。
使用函数可以：
1. 提高代码复用性
2. 增强代码可读性
3. 便于维护和测试
4. 实现模块化编程
"""

# ----------------------------------------------------------------------------
# 定义函数
# ----------------------------------------------------------------------------

# 使用 def 关键字定义函数
def greet():
    """打印问候语"""
    print("你好，欢迎学习Python！")

# 调用函数
greet()

# 【PyCharm 技巧】
# 按住 Ctrl 点击函数名，可以跳转到函数定义
# 按 Ctrl+B 也可以跳转到定义

# ----------------------------------------------------------------------------
# 函数文档字符串
# ----------------------------------------------------------------------------

def calculate_area(radius):
    """
    计算圆的面积
    
    参数:
        radius (float): 圆的半径
    
    返回:
        float: 圆的面积
    
    示例:
        >>> calculate_area(5)
        78.53981633974483
    """
    import math
    return math.pi * radius ** 2

# 【PyCharm 技巧】
# 将鼠标悬停在函数名上，可以看到文档字符串
# 按 Ctrl+Q 可以快速查看文档

# ============================================================================
# 第二部分：函数参数
# ============================================================================

# ----------------------------------------------------------------------------
# 位置参数
# ----------------------------------------------------------------------------

def add(a, b):
    """两数相加"""
    return a + b

# 按位置传递参数
result = add(3, 5)
print(f"3 + 5 = {result}")

# ----------------------------------------------------------------------------
# 关键字参数
# ----------------------------------------------------------------------------

def introduce(name, age, city):
    """自我介绍"""
    print(f"我叫{name}，今年{age}岁，来自{city}")

# 按关键字传递（顺序可以改变）
introduce(age=20, city="北京", name="张三")

# 混合使用（位置参数必须在前）
introduce("李四", city="上海", age=22)

# ----------------------------------------------------------------------------
# 默认参数
# ----------------------------------------------------------------------------

def power(base, exponent=2):
    """计算幂，默认平方"""
    return base ** exponent

print(f"power(3) = {power(3)}")       # 使用默认值
print(f"power(3, 3) = {power(3, 3)}") # 指定指数

# 【注意】默认参数必须在位置参数之后
# def wrong(a=1, b):  # SyntaxError

# 【陷阱】可变默认参数
def add_item(item, lst=[]):  # 危险！
    """添加项目到列表"""
    lst.append(item)
    return lst

print(add_item(1))  # [1]
print(add_item(2))  # [1, 2] - 意料之外！默认列表被修改

# 正确做法
def add_item_correct(item, lst=None):
    """添加项目到列表（正确写法）"""
    if lst is None:
        lst = []
    lst.append(item)
    return lst

print(add_item_correct(1))  # [1]
print(add_item_correct(2))  # [2]

# ============================================================================
# 第三部分：可变参数
# ============================================================================

# ----------------------------------------------------------------------------
# *args - 可变位置参数
# ----------------------------------------------------------------------------

def sum_all(*args):
    """计算所有参数的和"""
    total = 0
    for num in args:
        total += num
    return total

print(f"sum_all(1, 2, 3) = {sum_all(1, 2, 3)}")
print(f"sum_all(1, 2, 3, 4, 5) = {sum_all(1, 2, 3, 4, 5)}")

# args 是一个元组
def show_args(*args):
    print(f"类型: {type(args)}")
    print(f"内容: {args}")

show_args(1, 2, 3, "hello")

# 解包列表/元组
numbers = [1, 2, 3, 4, 5]
print(f"解包: {sum_all(*numbers)}")

# ----------------------------------------------------------------------------
# **kwargs - 可变关键字参数
# ----------------------------------------------------------------------------

def print_info(**kwargs):
    """打印关键字参数"""
    for key, value in kwargs.items():
        print(f"  {key}: {value}")

print("学生信息:")
print_info(name="张三", age=20, city="北京")

# kwargs 是一个字典
def show_kwargs(**kwargs):
    print(f"类型: {type(kwargs)}")
    print(f"内容: {kwargs}")

show_kwargs(a=1, b=2, c=3)

# 解包字典
info = {"name": "李四", "age": 22}
print_info(**info)

# ----------------------------------------------------------------------------
# 组合使用
# ----------------------------------------------------------------------------

def func(a, b, *args, **kwargs):
    """演示参数组合"""
    print(f"a = {a}")
    print(f"b = {b}")
    print(f"args = {args}")
    print(f"kwargs = {kwargs}")

func(1, 2, 3, 4, x=5, y=6)

# 参数顺序规则：位置参数 → 默认参数 → *args → **kwargs

# ============================================================================
# 第四部分：返回值
# ============================================================================

# ----------------------------------------------------------------------------
# 基本返回值
# ----------------------------------------------------------------------------

def square(x):
    """返回平方值"""
    return x ** 2

result = square(5)
print(f"5的平方: {result}")

# 无返回值的函数返回 None
def no_return():
    print("没有return语句")

result = no_return()
print(f"返回值: {result}")  # None

# ----------------------------------------------------------------------------
# 多返回值
# ----------------------------------------------------------------------------

def get_stats(numbers):
    """返回最小值、最大值和平均值"""
    return min(numbers), max(numbers), sum(numbers) / len(numbers)

# 接收元组
stats = get_stats([1, 2, 3, 4, 5])
print(f"统计: {stats}")

# 解包接收
minimum, maximum, average = get_stats([1, 2, 3, 4, 5])
print(f"最小={minimum}, 最大={maximum}, 平均={average}")

# 返回字典
def create_user(name, age):
    """创建用户字典"""
    return {
        "name": name,
        "age": age,
        "active": True
    }

user = create_user("张三", 20)
print(f"用户: {user}")

# ============================================================================
# 第五部分：函数作为对象
# ============================================================================

# ----------------------------------------------------------------------------
# 函数赋值给变量
# ----------------------------------------------------------------------------

def greet():
    print("Hello!")

# 函数赋值给变量
say_hello = greet
say_hello()  # 调用

# ----------------------------------------------------------------------------
# 函数作为参数
# ----------------------------------------------------------------------------

def apply_operation(x, y, operation):
    """应用操作"""
    return operation(x, y)

def add(a, b):
    return a + b

def multiply(a, b):
    return a * b

print(f"加法: {apply_operation(5, 3, add)}")
print(f"乘法: {apply_operation(5, 3, multiply)}")

# ----------------------------------------------------------------------------
# 函数作为返回值
# ----------------------------------------------------------------------------

def get_multiplier(factor):
    """返回一个乘法函数"""
    def multiplier(x):
        return x * factor
    return multiplier

double = get_multiplier(2)
triple = get_multiplier(3)

print(f"双倍: {double(5)}")
print(f"三倍: {triple(5)}")

# ============================================================================
# 第六部分：变量作用域
# ============================================================================

# ----------------------------------------------------------------------------
# 局部变量和全局变量
# ----------------------------------------------------------------------------

x = 10  # 全局变量

def func1():
    x = 20  # 局部变量（同名遮蔽）
    print(f"函数内 x = {x}")

def func2():
    global x  # 声明使用全局变量
    x = 30
    print(f"修改全局 x = {x}")

print(f"原始 x = {x}")
func1()
print(f"func1 后 x = {x}")  # 不变
func2()
print(f"func2 后 x = {x}")  # 改变

# ----------------------------------------------------------------------------
# nonlocal 关键字
# ----------------------------------------------------------------------------

def outer():
    count = 0
    
    def inner():
        nonlocal count  # 引用外层函数的变量
        count += 1
        return count
    
    return inner

counter = outer()
print(f"计数: {counter()}")  # 1
print(f"计数: {counter()}")  # 2
print(f"计数: {counter()}")  # 3

# ============================================================================
# 第七部分：类型提示（Python 3.5+）
# ============================================================================

def add_numbers(a: int, b: int) -> int:
    """
    两数相加（带类型提示）
    
    参数:
        a: 第一个整数
        b: 第二个整数
    
    返回:
        两数之和
    """
    return a + b

def greet_user(name: str, age: int = 18) -> str:
    """返回问候语"""
    return f"你好，{name}！你今年{age}岁。"

# 类型提示不影响运行，只是提示
result = add_numbers(3, 5)
message = greet_user("张三")

# 【PyCharm 技巧】
# PyCharm 会根据类型提示提供代码补全和错误检查
# 类型不匹配时会显示警告

# ============================================================================
# 练习题
# ============================================================================
"""
【练习1】定义函数
1. 编写函数计算阶乘
2. 编写函数判断是否为质数
3. 编写函数反转字符串

【练习2】参数使用
1. 编写函数计算任意数量数字的平均值
2. 编写函数创建学生信息（使用关键字参数）
3. 编写函数实现可配置的问候语

【练习3】返回值
1. 编写函数同时返回商和余数
2. 编写函数返回斐波那契数列前n项
3. 编写函数返回列表中出现次数最多的元素
"""

# ============================================================================
# 本节小结
# ============================================================================
"""
✅ 掌握的知识点：
1. 函数的定义和调用
2. 文档字符串的使用
3. 位置参数、关键字参数、默认参数
4. *args 和 **kwargs 可变参数
5. 返回值和多返回值
6. 函数作为对象
7. 变量作用域（local, global, nonlocal）
8. 类型提示

🔧 PyCharm 技巧：
1. Ctrl+B / Ctrl+点击 跳转到定义
2. Ctrl+Q 查看文档
3. Ctrl+P 查看参数信息
4. Shift+F6 重命名函数

➡️ 下一节：参数与返回值
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("函数基础模块学习完成！")
    print("=" * 60)
