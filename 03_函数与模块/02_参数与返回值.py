#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
模块名称：参数与返回值
学习目标：深入理解函数参数传递机制和返回值的处理
PyCharm 技巧：学习查看函数调用栈
============================================================================
"""

# ============================================================================
# 第一部分：参数传递机制
# ============================================================================
"""
【概念讲解】
Python 参数传递是"传对象引用"：
- 不可变对象（int, str, tuple）：类似值传递
- 可变对象（list, dict, set）：类似引用传递
"""

# ----------------------------------------------------------------------------
# 不可变对象传递
# ----------------------------------------------------------------------------

def modify_immutable(x):
    """尝试修改不可变对象"""
    x = x + 1  # 创建新对象
    print(f"函数内 x = {x}")

num = 10
modify_immutable(num)
print(f"函数外 num = {num}")  # 仍然是 10

# ----------------------------------------------------------------------------
# 可变对象传递
# ----------------------------------------------------------------------------

def modify_mutable(lst):
    """修改可变对象"""
    lst.append(4)
    print(f"函数内 lst = {lst}")

numbers = [1, 2, 3]
modify_mutable(numbers)
print(f"函数外 numbers = {numbers}")  # [1, 2, 3, 4] - 被修改了！

# 避免修改原对象的方法
def safe_modify(lst):
    """安全修改（创建副本）"""
    new_lst = lst.copy()
    new_lst.append(4)
    return new_lst

original = [1, 2, 3]
new_list = safe_modify(original)
print(f"原列表: {original}")  # [1, 2, 3]
print(f"新列表: {new_list}")  # [1, 2, 3, 4]

# ============================================================================
# 第二部分：参数类型详解
# ============================================================================

# ----------------------------------------------------------------------------
# 仅位置参数 (Python 3.8+)
# ----------------------------------------------------------------------------

def greet(name, /, greeting="你好"):
    """
    / 之前的参数只能通过位置传递
    
    参数:
        name: 仅位置参数
        greeting: 可以位置或关键字传递
    """
    print(f"{greeting}, {name}!")

greet("张三")              # 正确
greet("张三", "欢迎")      # 正确
# greet(name="张三")       # 错误：name 是仅位置参数

# ----------------------------------------------------------------------------
# 仅关键字参数
# ----------------------------------------------------------------------------

def create_user(*, name, age, email):
    """
    * 之后的参数必须通过关键字传递
    这样可以让代码更清晰
    """
    return {"name": name, "age": age, "email": email}

user = create_user(name="张三", age=20, email="test@example.com")
# create_user("张三", 20, "test@example.com")  # 错误

# ----------------------------------------------------------------------------
# 混合参数类型
# ----------------------------------------------------------------------------

def complex_func(a, b, /, c, d, *, e, f):
    """
    参数顺序：
    1. 仅位置参数 (a, b)
    2. 普通参数 (c, d)
    3. 仅关键字参数 (e, f)
    """
    print(f"a={a}, b={b}, c={c}, d={d}, e={e}, f={f}")

# complex_func(1, 2, 3, d=4, e=5, f=6)

# ============================================================================
# 第三部分：返回值详解
# ============================================================================

# ----------------------------------------------------------------------------
# 返回多个值
# ----------------------------------------------------------------------------

def get_min_max_avg(numbers):
    """返回最小值、最大值、平均值"""
    if not numbers:
        return None, None, None
    
    return min(numbers), max(numbers), sum(numbers) / len(numbers)

# 解包接收
minimum, maximum, average = get_min_max_avg([1, 2, 3, 4, 5])
print(f"最小={minimum}, 最大={maximum}, 平均={average}")

# 作为元组接收
result = get_min_max_avg([1, 2, 3, 4, 5])
print(f"结果元组: {result}")

# ----------------------------------------------------------------------------
# 返回字典
# ----------------------------------------------------------------------------

def analyze_text(text):
    """分析文本，返回统计信息"""
    return {
        "length": len(text),
        "words": len(text.split()),
        "chars": len(text.replace(" ", "")),
        "lines": len(text.splitlines())
    }

stats = analyze_text("Hello World\nPython")
print(f"文本统计: {stats}")

# ----------------------------------------------------------------------------
# 返回函数
# ----------------------------------------------------------------------------

def get_operator(op):
    """根据运算符返回对应的函数"""
    operators = {
        '+': lambda a, b: a + b,
        '-': lambda a, b: a - b,
        '*': lambda a, b: a * b,
        '/': lambda a, b: a / b if b != 0 else None,
    }
    return operators.get(op)

add_func = get_operator('+')
print(f"5 + 3 = {add_func(5, 3)}")

# ============================================================================
# 第四部分：生成器函数
# ============================================================================

# ----------------------------------------------------------------------------
# yield 关键字
# ----------------------------------------------------------------------------

def count_up_to(n):
    """生成从 1 到 n 的数字"""
    i = 1
    while i <= n:
        yield i
        i += 1

# 使用生成器
counter = count_up_to(5)
print(f"生成器: {counter}")

# 遍历生成器
for num in count_up_to(5):
    print(num, end=" ")
print()

# 使用 next() 获取下一个值
gen = count_up_to(3)
print(f"第一个: {next(gen)}")
print(f"第二个: {next(gen)}")

# ----------------------------------------------------------------------------
# 生成器表达式 vs 列表推导式
# ----------------------------------------------------------------------------

# 列表推导式 - 立即计算
squares_list = [x ** 2 for x in range(10)]
print(f"列表: {squares_list}")

# 生成器表达式 - 惰性计算
squares_gen = (x ** 2 for x in range(10))
print(f"生成器: {list(squares_gen)}")

# 处理大数据时使用生成器节省内存
# sum(x ** 2 for x in range(1000000))

# ============================================================================
# 第五部分：函数注解
# ============================================================================

def calculate_area(
    width: float,
    height: float,
    unit: str = "m"
) -> str:
    """
    计算矩形面积（带完整注解）
    
    参数:
        width: 宽度
        height: 高度
        unit: 单位
    
    返回:
        格式化的面积字符串
    """
    area = width * height
    return f"{area:.2f} {unit}²"

result = calculate_area(5.5, 3.2, "m")
print(f"面积: {result}")

# 查看函数注解
print(f"注解: {calculate_area.__annotations__}")

# ============================================================================
# 本节小结
# ============================================================================
"""
✅ 掌握的知识点：
1. 参数传递机制（传对象引用）
2. 仅位置参数和仅关键字参数
3. 多返回值处理
4. 生成器函数
5. 函数注解

➡️ 下一节：作用域与闭包
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("参数与返回值模块学习完成！")
    print("=" * 60)
