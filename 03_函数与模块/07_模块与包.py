#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
模块名称：模块与包
学习目标：掌握 Python 模块和包的组织和使用方法
PyCharm 技巧：学习项目结构和模块管理
============================================================================
"""

# ============================================================================
# 第一部分：模块基础
# ============================================================================
"""
【概念讲解】
模块（Module）是一个包含 Python 代码的 .py 文件。
模块可以定义函数、类、变量，也可以包含可执行代码。
使用模块可以：
1. 组织代码，提高可维护性
2. 实现代码复用
3. 避免命名冲突
4. 实现命名空间隔离
"""

# ----------------------------------------------------------------------------
# 导入模块
# ----------------------------------------------------------------------------

# 导入整个模块
import math
print(f"π = {math.pi}")
print(f"sqrt(16) = {math.sqrt(16)}")

# 导入模块并设置别名
import numpy as np  # 常见别名
import datetime as dt
print(f"今天: {dt.date.today()}")

# 导入模块中的特定对象
from math import pi, sqrt
print(f"π = {pi}")
print(f"sqrt(25) = {sqrt(25)}")

# 导入模块中的所有对象（不推荐）
from math import *
# 这会污染命名空间，可能造成命名冲突

# 导入并设置别名
from collections import OrderedDict as OD

# 【PyCharm 技巧】
# 输入模块名后按 Alt+Enter 可以自动导入
# 按 Ctrl+Alt+O 可以优化导入（删除未使用的导入）

# ----------------------------------------------------------------------------
# __name__ 变量
# ----------------------------------------------------------------------------

"""
当模块被直接运行时，__name__ == "__main__"
当模块被导入时，__name__ == 模块名
"""

def main():
    """主函数"""
    print("这是主程序")

if __name__ == "__main__":
    # 只有直接运行时才执行
    main()

# ----------------------------------------------------------------------------
# 模块搜索路径
# ----------------------------------------------------------------------------

import sys
print("模块搜索路径:")
for path in sys.path[:3]:
    print(f"  {path}")

# 添加自定义搜索路径
# sys.path.append("/path/to/module")

# ============================================================================
# 第二部分：创建自己的模块
# ============================================================================

# ----------------------------------------------------------------------------
# 创建工具模块
# ----------------------------------------------------------------------------

"""
假设我们创建一个工具模块 utils.py，内容如下：

# utils.py
\"\"\"工具函数模块\"\"\"

def add(a, b):
    return a + b

def subtract(a, b):
    return a - b

PI = 3.14159
"""

# 使用自定义模块
# from utils import add, PI
# result = add(1, 2)

# ----------------------------------------------------------------------------
# 模块的特殊属性
# ----------------------------------------------------------------------------

print(f"模块名: {__name__}")
print(f"模块文档: {__doc__[:50]}...")
print(f"模块文件: {__file__}")

# 查看模块的所有属性
import math
print(f"math 模块属性: {dir(math)[:5]}...")

# ============================================================================
# 第三部分：包（Package）
# ============================================================================
"""
【概念讲解】
包是一个包含 __init__.py 文件的目录，用于组织多个模块。
包可以嵌套，形成层级结构。

包的结构：
mypackage/
├── __init__.py
├── module1.py
├── module2.py
└── subpackage/
    ├── __init__.py
    └── module3.py
"""

# ----------------------------------------------------------------------------
# 导入包中的模块
# ----------------------------------------------------------------------------

# 方式1：导入整个包
# import mypackage
# mypackage.module1.func()

# 方式2：导入包中的模块
# import mypackage.module1
# mypackage.module1.func()

# 方式3：from...import
# from mypackage import module1
# module1.func()

# 方式4：导入特定函数
# from mypackage.module1 import func
# func()

# 方式5：导入子包
# from mypackage.subpackage import module3

# ----------------------------------------------------------------------------
# __init__.py 文件
# ----------------------------------------------------------------------------

"""
__init__.py 文件的作用：
1. 标识目录为 Python 包
2. 执行包的初始化代码
3. 控制模块的导入行为

示例 __init__.py：

# mypackage/__init__.py
\"\"\"我的包\"\"\"

from .module1 import func1
from .module2 import func2

__all__ = ['func1', 'func2', 'module1', 'module2']

# 这样可以直接使用：
# from mypackage import func1, func2
"""

# ----------------------------------------------------------------------------
# 相对导入和绝对导入
# ----------------------------------------------------------------------------

"""
假设包结构：
mypackage/
├── __init__.py
├── module1.py
└── subpackage/
    ├── __init__.py
    └── module2.py

在 module2.py 中：

# 绝对导入
from mypackage import module1
from mypackage.module1 import func

# 相对导入
from .. import module1        # 导入上级目录的模块
from ..module1 import func    # 导入上级目录模块的函数
from . import other_module    # 导入同级目录的模块
"""

# ============================================================================
# 第四部分：常用标准库模块
# ============================================================================

# ----------------------------------------------------------------------------
# os 模块 - 操作系统接口
# ----------------------------------------------------------------------------

import os

# 环境变量
print(f"当前目录: {os.getcwd()}")
print(f"HOME: {os.environ.get('HOME', '未设置')}")

# 路径操作
path = os.path.join("folder", "subfolder", "file.txt")
print(f"拼接路径: {path}")

print(f"是否存在: {os.path.exists('.')}")

# ----------------------------------------------------------------------------
# sys 模块 - 系统相关
# ----------------------------------------------------------------------------

import sys

print(f"Python 版本: {sys.version}")
print(f"平台: {sys.platform}")
print(f"命令行参数: {sys.argv}")

# ----------------------------------------------------------------------------
# datetime 模块 - 日期时间
# ----------------------------------------------------------------------------

from datetime import datetime, date, timedelta

# 当前时间
now = datetime.now()
print(f"当前时间: {now}")
print(f"格式化: {now.strftime('%Y-%m-%d %H:%M:%S')}")

# 日期计算
tomorrow = date.today() + timedelta(days=1)
print(f"明天: {tomorrow}")

# 解析日期
parsed = datetime.strptime("2024-01-01", "%Y-%m-%d")
print(f"解析: {parsed}")

# ----------------------------------------------------------------------------
# json 模块 - JSON 处理
# ----------------------------------------------------------------------------

import json

# 字典转 JSON
data = {"name": "张三", "age": 20}
json_str = json.dumps(data, ensure_ascii=False, indent=2)
print(f"JSON 字符串:\n{json_str}")

# JSON 转字典
parsed = json.loads(json_str)
print(f"解析后: {parsed}")

# ----------------------------------------------------------------------------
# random 模块 - 随机数
# ----------------------------------------------------------------------------

import random

# 随机整数
print(f"随机整数(1-10): {random.randint(1, 10)}")

# 随机选择
items = ["苹果", "香蕉", "橙子"]
print(f"随机选择: {random.choice(items)}")

# 打乱顺序
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)
print(f"打乱后: {numbers}")

# 随机采样
print(f"采样3个: {random.sample(range(100), 3)}")

# ----------------------------------------------------------------------------
# re 模块 - 正则表达式
# ----------------------------------------------------------------------------

import re

# 匹配
pattern = r'\d+'
text = "手机号: 13812345678"
match = re.search(pattern, text)
if match:
    print(f"找到数字: {match.group()}")

# 替换
result = re.sub(r'\d+', '***', text)
print(f"替换后: {result}")

# 分割
result = re.split(r'[,;]', "a,b;c,d")
print(f"分割: {result}")

# ----------------------------------------------------------------------------
# collections 模块 - 容器
# ----------------------------------------------------------------------------

from collections import Counter, defaultdict, namedtuple

# Counter 计数
words = ["apple", "banana", "apple", "orange", "apple"]
counter = Counter(words)
print(f"计数: {counter}")

# defaultdict 默认值
dd = defaultdict(list)
dd["fruits"].append("apple")
print(f"默认字典: {dd}")

# namedtuple 命名元组
Point = namedtuple('Point', ['x', 'y'])
p = Point(3, 4)
print(f"点: {p}, x={p.x}, y={p.y}")

# ----------------------------------------------------------------------------
# itertools 模块 - 迭代工具
# ----------------------------------------------------------------------------

import itertools

# 无限计数器
counter = itertools.count(start=1, step=2)
print(f"计数器: {next(counter)}, {next(counter)}, {next(counter)}")

# 排列组合
print(f"排列: {list(itertools.permutations([1, 2, 3], 2))}")
print(f"组合: {list(itertools.combinations([1, 2, 3], 2))}")

# 链接迭代器
print(f"链接: {list(itertools.chain([1, 2], [3, 4]))}")

# ============================================================================
# 第五部分：第三方模块管理
# ============================================================================

# ----------------------------------------------------------------------------
# pip 包管理器
# ----------------------------------------------------------------------------

"""
常用 pip 命令：

# 安装包
pip install package_name

# 安装指定版本
pip install package_name==1.0.0

# 卸载包
pip uninstall package_name

# 列出已安装的包
pip list

# 查看包信息
pip show package_name

# 导出依赖
pip freeze > requirements.txt

# 从文件安装依赖
pip install -r requirements.txt

# 升级包
pip install --upgrade package_name
"""

# ----------------------------------------------------------------------------
# requirements.txt
# ----------------------------------------------------------------------------

"""
requirements.txt 格式示例：

requests>=2.28.0
numpy>=1.21.0,<2.0.0
pandas==1.5.0
flask  # 任意版本

版本说明：
== 精确版本
>= 最小版本
<= 最大版本
> 大于
< 小于
~= 兼容版本（如 ~=1.4 等同于 >=1.4,<2.0）
"""

# ============================================================================
# 第六部分：模块开发最佳实践
# ============================================================================

# ----------------------------------------------------------------------------
# 模块组织结构
# ----------------------------------------------------------------------------

"""
推荐的项目结构：

project/
├── src/
│   └── mypackage/
│       ├── __init__.py
│       ├── core.py
│       ├── utils.py
│       └── tests/
│           ├── __init__.py
│           └── test_core.py
├── docs/
├── README.md
├── requirements.txt
├── setup.py
└── .gitignore
"""

# ----------------------------------------------------------------------------
# __all__ 变量
# ----------------------------------------------------------------------------

"""
在模块中定义 __all__，控制 from module import * 的行为：

# module.py
__all__ = ['func1', 'func2', 'ClassA']

def func1(): pass
def func2(): pass
def func3(): pass  # 不会被 import * 导入
"""

# ============================================================================
# 练习题
# ============================================================================
"""
【练习1】创建模块
创建一个计算器模块 calculator.py，包含：
1. 基本运算函数（加、减、乘、除）
2. 高级运算函数（幂、开方、对数）
3. 在另一个文件中导入使用

【练习2】创建包
创建一个图形处理包 geometry，包含：
1. circle.py - 圆相关计算
2. rectangle.py - 矩形相关计算
3. triangle.py - 三角形相关计算
4. 在 __init__.py 中统一导出

【练习3】使用标准库
1. 使用 os 模块遍历目录
2. 使用 datetime 计算两个日期的差
3. 使用 json 读写配置文件
"""

# ============================================================================
# 本节小结
# ============================================================================
"""
✅ 掌握的知识点：
1. 模块的导入方式
2. __name__ 变量的作用
3. 包的结构和 __init__.py
4. 相对导入和绝对导入
5. 常用标准库模块
6. pip 包管理
7. 项目组织结构

🔧 PyCharm 技巧：
1. Alt+Enter 自动导入
2. Ctrl+Alt+O 优化导入
3. 项目结构面板管理包
4. Terminal 中使用 pip

➡️ 恭喜完成函数与模块模块！
➡️ 下一模块：面向对象编程
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("模块与包学习完成！")
    print("函数与模块模块全部完成！")
    print("=" * 60)
