#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
============================================================================
æ¨¡å—åç§°ï¼šç»§æ‰¿ä¸å¤šæ€
å­¦ä¹ ç›®æ ‡ï¼šæ·±å…¥ç†è§£ç»§æ‰¿æœºåˆ¶å’Œå¤šæ€ç‰¹æ€§
PyCharm æŠ€å·§ï¼šå­¦ä¹ æŸ¥çœ‹ç±»çš„ç»§æ‰¿å…³ç³»
============================================================================
"""

# ============================================================================
# ç¬¬ä¸€éƒ¨åˆ†ï¼šç»§æ‰¿è¯¦è§£
# ============================================================================

# ----------------------------------------------------------------------------
# å•ç»§æ‰¿
# ----------------------------------------------------------------------------

class Animal:
    """åŠ¨ç‰©åŸºç±»"""
    
    def __init__(self, name):
        self.name = name
    
    def speak(self):
        """å‘å£°"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°æ­¤æ–¹æ³•")
    
    def info(self):
        return f"æˆ‘æ˜¯{self.name}"

class Dog(Animal):
    """ç‹—ç±»"""
    
    def __init__(self, name, breed):
        super().__init__(name)  # è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
        self.breed = breed
    
    def speak(self):
        return "æ±ªæ±ªæ±ª"
    
    def fetch(self):
        return f"{self.name}å»æ¡çƒ"

# ä½¿ç”¨ super() çš„å…¶ä»–æ–¹å¼
class Cat(Animal):
    """çŒ«ç±»"""
    
    def __init__(self, name, color):
        # Animal.__init__(self, name)  # æ—§å¼å†™æ³•
        super().__init__(name)  # æ¨èå†™æ³•
        self.color = color
    
    def speak(self):
        return "å–µå–µå–µ"

dog = Dog("æ—ºè´¢", "é‡‘æ¯›")
cat = Cat("å’ªå’ª", "æ©˜è‰²")

print(dog.info())
print(dog.speak())
print(dog.fetch())

# ----------------------------------------------------------------------------
# å¤šç»§æ‰¿
# ----------------------------------------------------------------------------

class Flyable:
    """å¯é£è¡Œçš„"""
    
    def fly(self):
        return f"{self.name}æ­£åœ¨é£è¡Œ"

class Swimmable:
    """å¯æ¸¸æ³³çš„"""
    
    def swim(self):
        return f"{self.name}æ­£åœ¨æ¸¸æ³³"

class Duck(Animal, Flyable, Swimmable):
    """é¸­å­ç±» - å¤šç»§æ‰¿"""
    
    def speak(self):
        return "å˜å˜å˜"

duck = Duck("å”è€é¸­")
print(duck.speak())
print(duck.fly())
print(duck.swim())

# æ–¹æ³•è§£æé¡ºåº (MRO)
print(f"Duck MRO: {Duck.__mro__}")

# ----------------------------------------------------------------------------
# Mixin æ¨¡å¼
# ----------------------------------------------------------------------------

class LoggingMixin:
    """æ—¥å¿—æ··å…¥ç±»"""
    
    def log(self, message):
        print(f"[LOG] {self.__class__.__name__}: {message}")

class User(LoggingMixin):
    """ç”¨æˆ·ç±»ï¼ˆæ··å…¥æ—¥å¿—åŠŸèƒ½ï¼‰"""
    
    def __init__(self, name):
        self.name = name
    
    def login(self):
        self.log(f"{self.name} ç™»å½•æˆåŠŸ")

user = User("å¼ ä¸‰")
user.login()

# ============================================================================
# ç¬¬äºŒéƒ¨åˆ†ï¼šå¤šæ€
# ============================================================================

# ----------------------------------------------------------------------------
# å¤šæ€ç¤ºä¾‹
# ----------------------------------------------------------------------------

def animal_sound(animal):
    """è®©åŠ¨ç‰©å‘å£°ï¼ˆå¤šæ€ï¼‰"""
    print(f"{animal.name}: {animal.speak()}")

animals = [
    Dog("æ—ºè´¢", "é‡‘æ¯›"),
    Cat("å’ªå’ª", "æ©˜è‰²"),
    Duck("å”è€é¸­"),
]

for animal in animals:
    animal_sound(animal)

# ----------------------------------------------------------------------------
# é¸­å­ç±»å‹
# ----------------------------------------------------------------------------

"""
é¸­å­ç±»å‹ï¼š"å¦‚æœå®ƒèµ°èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒå°±æ˜¯é¸­å­"
ä¸å…³æ³¨å¯¹è±¡çš„ç±»å‹ï¼Œåªå…³æ³¨å¯¹è±¡çš„è¡Œä¸º
"""

class Car:
    """æ±½è½¦ç±»"""
    
    def __init__(self, name):
        self.name = name
    
    def speak(self):
        return "å˜€å˜€å˜€"

def make_sound(obj):
    """è®©ä»»ä½•æœ‰ speak æ–¹æ³•çš„å¯¹è±¡å‘å£°"""
    print(f"{obj.name}: {obj.speak()}")

# Car ä¸æ˜¯ Animalï¼Œä½†æœ‰ speak æ–¹æ³•
car = Car("å°æ±½è½¦")
make_sound(car)  # å¯ä»¥å·¥ä½œï¼

# ============================================================================
# ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡ç±»
# ============================================================================

from abc import ABC, abstractmethod

class Shape(ABC):
    """å½¢çŠ¶æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def area(self):
        """è®¡ç®—é¢ç§¯"""
        pass
    
    @abstractmethod
    def perimeter(self):
        """è®¡ç®—å‘¨é•¿"""
        pass
    
    def describe(self):
        """æè¿°ï¼ˆå…·ä½“æ–¹æ³•ï¼‰"""
        return f"é¢ç§¯: {self.area()}, å‘¨é•¿: {self.perimeter()}"

class Rectangle(Shape):
    """çŸ©å½¢"""
    
    def __init__(self, width, height):
        self.width = width
        self.height = height
    
    def area(self):
        return self.width * self.height
    
    def perimeter(self):
        return 2 * (self.width + self.height)

class Circle(Shape):
    """åœ†å½¢"""
    
    def __init__(self, radius):
        self.radius = radius
    
    def area(self):
        import math
        return math.pi * self.radius ** 2
    
    def perimeter(self):
        import math
        return 2 * math.pi * self.radius

# ä½¿ç”¨
shapes = [Rectangle(3, 4), Circle(5)]

for shape in shapes:
    print(shape.describe())

# ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»
# shape = Shape()  # TypeError

# ============================================================================
# ç¬¬å››éƒ¨åˆ†ï¼šç±»å…³ç³»
# ============================================================================

# ----------------------------------------------------------------------------
# ç»„åˆ
# ----------------------------------------------------------------------------

class Engine:
    """å‘åŠ¨æœº"""
    
    def start(self):
        return "å‘åŠ¨æœºå¯åŠ¨"

class Car:
    """æ±½è½¦ï¼ˆç»„åˆï¼‰"""
    
    def __init__(self):
        self.engine = Engine()  # ç»„åˆï¼šæ‹¥æœ‰ä¸€ä¸ª Engine
    
    def start(self):
        return self.engine.start()

car = Car()
print(car.start())

# ----------------------------------------------------------------------------
# ç»§æ‰¿ vs ç»„åˆ
# ----------------------------------------------------------------------------

"""
é€‰æ‹©å»ºè®®ï¼š
- is-a å…³ç³»ï¼šä½¿ç”¨ç»§æ‰¿ï¼ˆç‹—æ˜¯åŠ¨ç‰©ï¼‰
- has-a å…³ç³»ï¼šä½¿ç”¨ç»„åˆï¼ˆæ±½è½¦æœ‰å‘åŠ¨æœºï¼‰

ä¼˜å…ˆä½¿ç”¨ç»„åˆï¼Œæ›´çµæ´»
"""

# ============================================================================
# ç¬¬äº”éƒ¨åˆ†ï¼šæ¥å£å’Œåè®®
# ============================================================================

# ----------------------------------------------------------------------------
# ä½¿ç”¨ Protocol (Python 3.8+)
# ----------------------------------------------------------------------------

from typing import Protocol

class Drawable(Protocol):
    """å¯ç»˜åˆ¶åè®®"""
    
    def draw(self) -> str:
        ...

class Square:
    """æ­£æ–¹å½¢"""
    
    def draw(self) -> str:
        return "ç»˜åˆ¶æ­£æ–¹å½¢"

def render(drawable: Drawable):
    """æ¸²æŸ“å¯ç»˜åˆ¶å¯¹è±¡"""
    print(drawable.draw())

square = Square()
render(square)  # Square å®ç°äº† Drawable åè®®

# ============================================================================
# æœ¬èŠ‚å°ç»“
# ============================================================================
"""
âœ… æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼š
1. å•ç»§æ‰¿å’Œå¤šç»§æ‰¿
2. super() å‡½æ•°çš„ä½¿ç”¨
3. MRO æ–¹æ³•è§£æé¡ºåº
4. Mixin æ¨¡å¼
5. å¤šæ€å’Œé¸­å­ç±»å‹
6. æŠ½è±¡ç±»
7. ç»„åˆ vs ç»§æ‰¿

ğŸ”§ PyCharm æŠ€å·§ï¼š
1. Ctrl+H æŸ¥çœ‹ç»§æ‰¿å±‚æ¬¡
2. Ctrl+O é‡å†™æ–¹æ³•
3. Alt+Insert ç”Ÿæˆä»£ç 

â¡ï¸ ä¸‹ä¸€èŠ‚ï¼šé­”æ³•æ–¹æ³•
"""

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("ç»§æ‰¿ä¸å¤šæ€æ¨¡å—å­¦ä¹ å®Œæˆï¼")
    print("=" * 60)
